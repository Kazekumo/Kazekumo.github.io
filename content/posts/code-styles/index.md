---
title: "从常见编程范式看关注点的分离"
date: "2023-05-20"
description: "从抽象方法看编程范式"
tags: ["code"]
ShowToc: false
ShowBreadCrumbs: true
---

软件开发就是在解决问题。那问题一般是如何解决的呢？

最常见的解决问题思路是分而治之，也就是说，我们要先把问题拆分开。在每个问题都得到解决之后，再把这些解决好的子问题以恰当的方式组装起来。

如何分解与组合，就是我们要在软件设计中考虑的问题。

大部分人都把焦点放在了如何组合上，却忽略了至关重要的第一步：分解。

**关注点分离**（Separation of concerns，SoC）是将计算机程序分隔为不同部分的设计原则。

以分离功能点为例，我们通常会进行树形的思考，进行流程性的拆分。
![](images/Pasted%20image%2020230725222418.png)
分离的方式有很多，除了流程的拆分，还有以下的形式：
- 前后分离：客户端与服务端分离
- 动静分离：把变和不变的内容分离
- 读写分离：把读和写分离
- 冷热分离：把低频和高频的分离
- 封装、多态：行为与实现的分离、变与不变的分离
...

下面简单的介绍一些编程范式，思考这些编程范式是如何进行抽象化拆分的。

## 编程范式
"编程范式"是一种**编程思想**的总称，它是指在编写程序时所采用的基本方法和规范。

这里介绍一些常见的范式。
### 命令式编程
命令式编程由一组详细的指令组成，让计算机以一定的顺序执行。之所以被称作“命令式”是因为开发者以非常具体的方式，准确地规定计算机必须做什么。

假如你想烤一个蛋糕，命令式编程的制作方式如下
```javascript
function makeCake() {
	1- 将面粉倒入碗中
	2- 在碗中打入两个鸡蛋
	3- 倒入一些牛奶
	4- 将它们混合
	5- 将混合物倒入模具
	6- 烤35分钟
	7- 冷却
}
```

若使用真实的代码，假设我们想要从一个数组中过滤出大于5的所有元素，命令式编程如下：
```javascript
const nums = [1,4,3,6,7,8,9,2]
const result = []

for (let i = 0; i < nums.length; i++) {
    if (nums[i] > 5) result.push(nums[i])
}

console.log(result) // 输出: [ 6, 7, 8, 9 ]
```
我们的指令非常的具体详尽，这就是命令式编程的特点。

### 过程式编程
在过程式编程中，开发者被鼓励将程序的执行拆分成不同的函数，以此来提高程序的模块化和组织性。
```javascript
function pourIngredients() {
    - 将面粉倒入碗中
    - 在碗中打入两个鸡蛋
    - 倒入一些牛奶
}

function mixAndTransferToMold() {
    - 将它们混合
    - 将混合物倒入模具
}

function cookAndLetChill() {
    - 烤35分钟
    - 冷却
}

function makeCake(){
	pourIngredients()  // 倒入配料
	mixAndTransferToMold() // 混合材料
	cookAndLetChill() // 烤制并冷却
}
```
虽然看起来只是拆分成了子过程，其实已经可以极大程度的减轻开发者的心智负担。

毕竟实际代码中，命令式编程长这样
![](images/Pasted%20image%2020230725232748.png)
### 声明式编程
声明式编程（Declarative Programming）是一种**关注描述问题逻辑和规则**编程范式。

在声明式编程中，我们通过声明所需的结果和约束条件，让计算机自行推导出解决方案，而不需要明确指定每个步骤的执行细节。

命令式代码是在说明怎么做（How），而声明式代码则是在说做什么（What）；

java中常见的注解，实际上就是声明式编程。
```java
@Transactional
public void test() {
     // 事务操作  
}
```
声明式编程将表达与运行分离。

### 面向对象
封装：构建模型，组合模块，隐藏细节
继承：`is-a` 关系，代码复用
多态：提高拓展性，不关注子类实现

### 函数式编程
#### 组合性
在函数式编程中，有一类比较特殊的函数，它们可以接收函数作为输入，或者返回一个函数作为输出。这种函数叫做高阶函数（High-order function）。

高阶函数有什么用呢？它的一个重要作用在于，我们可以用它去做行为的组合。

在业务流程中，数据经过一系列的列表转换会得到一个结果：
![](images/Pasted%20image%2020230725224715.png)
最基础的列表转换有三种典型模式，分别是 map、filter 和 reduce。

假设我们想要从一个数组中过滤出大于5的所有元素的和, 函数式编程如下

```javascript
const nums = [1,4,3,6,7,8,9,2]

console.log(nums.filter(num => num > 5).reduce((x,y)=>x+y,0)) 
```
从某种程度上来说，函数式编程分离了控制流与数据流。同时控制流可以进行灵活的组合。

#### 不变性
函数式编程的不变性主要体现在值和纯函数上。

值，可以将它理解为一个初始化之后就不再改变的量。
纯函数，是符合下面两点的函数：
- 对于相同的输入，给出相同的输出；
- 没有副作用。

值保证不会显式改变一个量，而纯函数保证的是，不会隐式改变一个量。

以java中一个常见的错误为例:
```java
class Sample {
  private static final DateFormat format = new SimpleDateFormat("yyyy.MM.dd");

  public String getCurrentDateText() {
    return format.format(new Date());
  }
}
```
这段代码在多线程环境下就会出问题，就像下面这张图看到的：
- A 线程把变量的值修改成自己需要的值；
- 这时发生线程切换，B 线程开始执行，将变量的值修改成它所需要的值；
- 线程切换回来，A 线程继续执行，但此时变量已经不是自己设置的值了，所以，执行会出错。
![](images/Pasted%20image%2020230725225713.png)

编写纯函数的重点是，不修改任何字段，也不调用修改字段内容的方法。

```java
String replace(char oldChar, char newChar);
```



## 合同模板编辑器的演进
//todo 

## ref

极客时间-软件设计之美

[关注点分离](https://zh.wikipedia.org/zh-cn/%E5%85%B3%E6%B3%A8%E7%82%B9%E5%88%86%E7%A6%BB)

[程序员必须要知道的编程范式](https://juejin.cn/post/7245176948522057765)

[从可逆计算看声明式编程](https://zhuanlan.zhihu.com/p/85492497) 